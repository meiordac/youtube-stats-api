<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="helpers.js"></script>
<script src="key.js"></script>
<script type="text/babel">

class Home extends React.Component {

    render() {
        const userToken = getCookie('user_token');
        console.log(document.cookie);
        if (userToken) {
            return <LiveStreamForm />; 
        }
        return <Login />;
    }
}

class Login extends React.Component {
    render() {
        return (<div><h1> Welcome, please login to continue </h1> <a href="http://localhost:3000/auth/google_oauth2">Sign in with Google</a></div>);
    }
}

class LiveStreamForm extends React.Component {

  constructor(props) {
    super(props);
    this.messages = [];
  }  



handleClick(event) {
    console.log(event);
    event.preventDefault();
    this.getVideo(event.target.value);
  }

  getVideo(value) {
    const token = getCookie('user_token');
    const videosRequest = `https://www.googleapis.com/youtube/v3/liveStreams?part=snippet%2CcontentDetails%2Cstatistics%2CliveStreamingDetails&id=${value}&key=${apiKey}`;
    let liveChatId;
    axios.get(videosRequest, { headers: {'Authorization' : `Bearer ${token}`}})
        .then(response => {
            console.log(response);
            liveChatId = response.items[0].liveStreamingDetails.activeLiveChatId;
            this.getMessages(liveChatId);
        });
  }

  getMessages(liveChatId) {
    const token = getCookie('user_token');
    const liveMessagesRequest = `https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${liveChatId}&part=id%2C+snippet%2C+authorDetails&key=${apiKey}`;
    axios.get(liveMessagesRequest, { headers: {'Authorization' : `Bearer ${token}`}})
        .then(response => {
                console.log(response);
                this.messages = response.items;
            });
  }

  render() {
    return (
        <div className="card">
            <div className="card-body">
                <div className="form-group">
                        <label htmlFor="liveVideo">Live video stream id</label>
                        <input className="form-control" id="liveVideo" placeholder="Enter live video stream id"></input>
                        <button className="btn-primary" onClick={ this.handleClick.bind(this) }>
                        Submit
                    </button>
                </div>
            </div>
        </div>
    );
  }
}

ReactDOM.render(
    <Home />,
    document.getElementById('root')
);

</script>